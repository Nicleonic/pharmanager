from django.db import models
from django.contrib.auth.models import Group
from django.contrib.auth.models import User
from django.contrib.auth.models import Permission
from django.contrib.contenttypes.models import ContentType


# Créer le groupe "SuperAgents"
SuperAgents, created = Group.objects.get_or_create(name='SuperAgents')

# Ajouter un utilisateur existant au groupe "Agents"
johnson = User.objects.get(username='johnson')
SuperAgents.user_set.add(johnson)

class Medicament(models.Model):
    class Meta:
        permissions = [
            ("publish_medicament", "Can publish a Medecine")
        ]
    id = models.AutoField(primary_key=True)
    nom = models.CharField(max_length=100)
    description = models.TextField()
    prix = models.DecimalField(max_digits=8, decimal_places=2)
    stock = models.IntegerField()
    date_creation = models.DateTimeField(auto_now_add=True)
    date_update = models.DateTimeField(auto_now=True)
    date_exp = models.DateField(blank=True, null=True)

    def __str__(self):
        return self.nom


class Agent(models.Model):
    nom = models.CharField(max_length=100)
    genre = models.CharField(max_length=10)
    phone = models.CharField(max_length=20)
    email = models.EmailField()

    def __str__(self):
        return self.nom

class Achat(models.Model):
    agent = models.ForeignKey(Agent, on_delete=models.CASCADE)
    medicament = models.ForeignKey(Medicament, on_delete=models.CASCADE)
    quantite = models.PositiveIntegerField()
    date_achat = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return f"Achat {self.id} - {self.medicament.nom} par {self.agent.nom} quantité {self.quantite}"


'''# Obtenez le contenu de modèle pour le modèle Medicament
content_type = ContentType.objects.get_for_model(Medicament)

# Créez la permission pour publier un médicament
publish_permission, created = Permission.objects.get_or_create(
    codename='publish_medicament',
    name='Can publish a Medicament',
    content_type=content_type
)

# Ajoutez la permission au groupe "SuperAgents"
SuperAgents.permissions.add(publish_permission)'''

'''

from django.contrib.auth.models import Permission

agent = Agent.objects.get(id=agent_id)  # Remplacez agent_id par l'ID de l'agent spécifique

# Obtenez le contenu de modèle pour le modèle Medicament
content_type = ContentType.objects.get_for_model(Medicament)

# Créez la permission pour modifier un médicament
change_permission, created = Permission.objects.get_or_create(
    codename='change_medicament',
    name='Can change a Medicament',
    content_type=content_type
)'''
'''
# Ajoutez la permission à l'agent
Agent.user_permissions.add(change_permission)'''